#!ipxe
# {{ ipxe_menu_title }}
# Generated by Ansible

:start
menu {{ ipxe_menu_title }}
item --gap --             Network Boot Options:
{% for option in ipxe_boot_options %}
{% if option.enabled %}
item {{ option.name | lower | replace(' ', '_') }} {{ option.description }}
{% endif %}
{% endfor %}
item --gap --             Actions:
item config               Network Configuration
item shell                iPXE Shell
item reboot               Reboot System
choose --timeout {{ ipxe_menu_timeout }} --default local selected || goto cancel
set menu-timeout 0
goto ${selected}

{% for option in ipxe_boot_options %}
{% if option.enabled %}
:{{ option.name | lower | replace(' ', '_') }}
{% if option.config == 'local' %}
exit
{% else %}
chain http://{{ ipxe_server_ip }}:{{ ipxe_server_port }}/configs/{{ option.config }}
{% endif %}

{% endif %}
{% endfor %}

:config
config
goto start

:shell
shell

:reboot
reboot

:cancel
echo Boot cancelled, dropping to shell
shell