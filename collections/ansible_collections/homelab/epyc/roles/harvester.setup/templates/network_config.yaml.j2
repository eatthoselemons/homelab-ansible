#cloud-config
network:
  version: 2
  ethernets:
{% for iface in item.interfaces %}
    {{ iface.name }}:
      match:
        macaddress: "{{ iface.hwaddr }}"
      set-name: {{ iface.name }}
      addresses:
        - {{ item.ip }}/24
      gateway4: 10.60.1.1
      nameservers:
        addresses:
{% for dns in harvester_dns_servers %}
          - {{ dns }}
{% endfor %}
      mtu: 1500
      dhcp4: false
      dhcp6: false
{% endfor %}

{% if harvester_storage_network.enabled %}
  vlans:
    vlan{{ harvester_storage_network.vlan }}:
      id: {{ harvester_storage_network.vlan }}
      link: {{ item.interfaces[0].name }}
      addresses:
{% if item.name == 'epyc-harvester' or item.name == 'test-harvester-1' %}
        - 10.60.65.11/24
{% elif item.name == 'mid-harvester' or item.name == 'test-harvester-2' %}
        - 10.60.65.12/24
{% elif item.name == 'thin-harvester' or item.name == 'test-harvester-3' %}
        - 10.60.65.13/24
{% endif %}
      mtu: 1500
{% endif %}